<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Analysis</title>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
<script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>body{font:12px sans-serif;background:#161512;color:#eee;display:flex;flex-direction:column;align-items:center}.c{width:100%;max-width:1000px;background:#262421;padding:15px;border-radius:12px}#top{display:flex;gap:15px;flex-wrap:wrap;justify-content:center}#b-w{width:340px;text-align:center}#myBoard{width:100%;border:3px solid #3c3934}.highlight{box-shadow:inset 0 0 3px 3px rgba(255,255,0,.7)}#chart-w{flex:1;min-width:300px;background:#1a1917;height:250px;border-radius:8px}.nav{display:flex;justify-content:space-between;margin-top:10px}.btn{background:#403d39;color:#fff;border:none;padding:8px 15px;border-radius:4px;cursor:pointer}#eval-d{font-weight:700;font-size:1.1rem}table{width:100%;border-collapse:collapse;margin-top:15px;background:#1a1917}th,td{padding:6px;border-bottom:1px solid #333;text-align:left}tr:hover{background:#333}.pos{color:#7fa650}.neg{color:#ca3431}</style></head>
<body><div class="c"><div id="top"><div id="b-w"><div id="myBoard"></div><div class="nav"><div><button id="pB" class="btn" onclick="step(-1)">←</button><button id="nB" class="btn" onclick="step(1)">→</button><button class="btn" onclick="board.flip()">Flip</button></div><div id="eval-d">0.0</div></div></div><div id="chart-w"><canvas id="evalChart"></canvas></div></div><p id="st" style="text-align:center">Init...</p><table><thead><tr><th>#</th><th>Move</th><th>Eval</th><th>FEN</th></tr></thead><tbody id="m-b"></tbody></table></div>
<script>
const UN='mrindyjones';let engine,board,chart,q=[],hist=[],ply=-1;
async function init(){try{const r=await fetch('https://raw.githubusercontent.com/niklasf/stockfish.js/master/stockfish.js'),s=await r.text(),b=new Blob([s],{type:'application/javascript'});engine=new Worker(URL.createObjectURL(b));engine.onmessage=e=>{const l=e.data.toString();if(l.includes('score cp')){const m=l.match(/score cp (-?\d+)/);if(m){let s=parseInt(m[1])/100;if(q[0].f.includes(' b '))s=-s;const v=(s>0?'+':'')+s.toFixed(1);hist[q[0].i].e=v;upR(q[0].i,v,s);chart.data.datasets[0].data[q[0].i]=s;chart.update()}}if(l.startsWith('bestmove')){q.shift();next()}};engine.postMessage('uci');run()}catch(e){console.error(e)}}
function upR(i,s,n){const c=document.getElementById(`e-${i}`);if(c){c.innerText=s;c.className=n<0?'neg':'pos'}if(i===ply)document.getElementById('eval-d').innerText=s}
function next(){if(q.length){const n=q[0];document.getElementById('st').innerText=`Analyzing ${n.i+1}...`;engine.postMessage(`position fen ${n.f}`);engine.postMessage('go depth 12')}else document.getElementById('st').innerText="Done"}
function show(i){ply=i;const m=hist[i];board.position(m.f);$('.square-55d63').removeClass('highlight');if(m.fr&&m.to){$(`.square-${m.fr}`).addClass('highlight');$(`.square-${m.to}`).addClass('highlight')}document.getElementById('eval-d').innerText=m.e||"...";document.getElementById('pB').disabled=i<=0;document.getElementById('nB').disabled=i>=hist.length-1}
function step(d){const n=ply+d;if(n>=0&&n<hist.length)show(n)}
async function run(){try{const r=await fetch(`https://lichess.org/api/user/${UN}/current-game?t=${Date.now()}`);if(r.status===204)return;const p=await r.text(),c=new Chess();c.load_pgn(p);const v=c.history({verbose:true});board.orientation(c.header().Black?.toLowerCase()===UN?'black':'white');const b=document.getElementById('m-b');b.innerHTML="";q=[];hist=[];chart.data.labels=[];chart.data.datasets[0].data=[];const t=new Chess();v.forEach((mv,i)=>{t.move(mv.san);const f=t.fen();const r=b.insertRow();r.onclick=()=>show(i);r.innerHTML=`<td>${i+1}</td><td>${mv.san}</td><td id="e-${i}">...</td><td>${f.slice(0,12)}</td>`;hist.push({i,f,m:mv.san,fr:mv.from,to:mv.to,e:null});q.push({i,f});chart.data.labels.push(mv.san);chart.data.datasets[0].data.push(null)});chart.update();show(hist.length-1);q.reverse();next()}catch(e){console.error(e)}}
$(document).ready(()=>{board=Chessboard('myBoard',{position:'start',pieceTheme:'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'});chart=new Chart(document.getElementById('evalChart').getContext('2d'),{type:'line',data:{labels:[],datasets:[{label:'Eval',data:[],borderColor:'#7fa650',fill:true}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{min:-10,max:10}}}});init()});
</script></body></html>

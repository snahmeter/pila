 <!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>MrIndyJones Analysis</title><script src="https://code.jquery.com/jquery-3.5.1.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script><link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css"><script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><style>body{font-family:sans-serif;background:#161512;color:#bababa;padding:10px;display:flex;flex-direction:column;align-items:center}.container{width:100%;max-width:1000px;background:#262421;padding:15px;border-radius:12px}#top-layout{display:flex;gap:15px;flex-wrap:wrap;justify-content:center}#board-wrapper{width:340px;text-align:center}#myBoard{width:100%;border:3px solid #3c3934}.highlight{box-shadow:inset 0 0 3px 3px rgba(255,255,0,0.7)}#chart-wrapper{flex:1;min-width:300px;background:#1a1917;height:250px;border-radius:8px;padding:5px}.nav-controls{display:flex;justify-content:space-between;align-items:center;margin-top:10px}.nav-btn{background:#403d39;color:#fff;border:none;padding:8px 15px;border-radius:4px;cursor:pointer;font-weight:700}.nav-btn:disabled{opacity:0.3;cursor:default}#current-eval-display{font-weight:bold;font-size:1.1rem;color:#fff}.main-btn{background:#45a049;color:#fff;border:none;padding:12px;border-radius:6px;font-weight:700;width:100%;margin-top:15px}#mobile-console{width:100%;height:80px;background:#000;color:#0f0;font-family:monospace;font-size:11px;padding:8px;margin-top:15px;overflow-y:scroll;border:1px solid #333;white-space:pre-wrap}table{width:100%;border-collapse:collapse;margin-top:15px;background:#1a1917;font-size:12px}th,td{padding:6px;border-bottom:1px solid #333;text-align:left}tbody tr{cursor:pointer}tbody tr:hover{background:#333}.pos{color:#7fa650}.neg{color:#ca3431}</style></head><body><div class="container"><div id="top-layout"><div id="board-wrapper"><div id="myBoard"></div><div class="nav-controls"><div><button id="prevBtn" class="nav-btn" onclick="step(-1)" disabled>←</button><button id="nextBtn" class="nav-btn" onclick="step(1)" disabled>→</button><button class="nav-btn" style="margin-left:5px" onclick="board.flip()">Flip</button></div><div id="current-eval-display">0.0</div></div></div><div id="chart-wrapper"><canvas id="evalChart"></canvas></div></div><button class="main-btn" onclick="fetchAndAnalyze()">Fetch & Analyze History</button><p id="status" style="text-align:center;margin:10px 0;font-size:13px">Ready.</p><table><thead><tr><th>#</th><th>Move</th><th>Eval</th><th>FEN Snapshot</th></tr></thead><tbody id="move-body"></tbody></table><div id="mobile-console">-- Console Initialized --</div></div><script>const USERNAME='mrindyjones';let engine=null,board,evalChart,evalQueue=[],fullHistory=[];let currentPly=-1;function log(m,e=false){const c=document.getElementById('mobile-console'),t=new Date().toLocaleTimeString();c.innerText+=`\n[${t}] ${e?'ERR: ':''}${m}`;c.scrollTop=c.scrollHeight}async function init(){if(engine)return;log("Engine Loading...");try{const r=await fetch('https://raw.githubusercontent.com/niklasf/stockfish.js/master/stockfish.js');const s=await r.text(),b=new Blob([s],{type:'application/javascript'});engine=new Worker(URL.createObjectURL(b));engine.onmessage=(e)=>{const l=typeof e.data==='string'?e.data:e.data.toString();if(l.includes('score cp')){const m=l.match(/score cp (-?\d+)/);if(m){let s=parseInt(m[1])/100;if(evalQueue[0].fen.includes(' b '))s=-s;const val=(s>0?'+':'')+s.toFixed(1);fullHistory[evalQueue[0].index].eval=val;updateRow(evalQueue[0].index,val,s);evalChart.data.labels.push(evalQueue[0].move);evalChart.data.datasets[0].data.push(s);evalChart.update()}}if(l.startsWith('bestmove')){evalQueue.shift();next()}};engine.postMessage('uci');log("Engine Online")}catch(err){log(err.message,true)}}function updateRow(idx,str,num){const c=document.getElementById(`eval-${idx}`);if(c){c.innerText=str;c.className='pos';if(num<0)c.className='neg'}if(idx===currentPly)document.getElementById('current-eval-display').innerText=str}function next(){if(!engine)return;if(evalQueue.length){const n=evalQueue[0];document.getElementById('status').innerText=`Analyzing ${n.index+1}...`;engine.postMessage(`position fen ${n.fen}`);engine.postMessage('go depth 12')}else{document.getElementById('status').innerText="Analysis Complete"}}function showPos(idx){currentPly=idx;const move=fullHistory[idx];board.position(move.fen);$('.square-55d63ad1').removeClass('highlight');if(move.from&&move.to){$(`#myBoard .square-${move.from}`).addClass('highlight');$(`#myBoard .square-${move.to}`).addClass('highlight')}document.getElementById('current-eval-display').innerText=move.eval||"...";document.getElementById('prevBtn').disabled=idx<=0;document.getElementById('nextBtn').disabled=idx>=fullHistory.length-1}function step(d){const newIdx=currentPly+d;if(newIdx>=0&&newIdx<fullHistory.length)showPos(newIdx)}async function fetchAndAnalyze(){await init();if(!engine)return;log("Fetching Lichess...");try{const r=await fetch(`https://lichess.org/api/user/${USERNAME}/current-game?t=${Date.now()}`);if(r.status===204)return;const p=await r.text(),c=new Chess();c.load_pgn(p);const v=c.history({verbose:true});board.orientation(c.header().Black?.toLowerCase()===USERNAME?'black':'white');const b=document.getElementById('move-body');b.innerHTML="";evalQueue=[];fullHistory=[];const t=new Chess();v.forEach((mv,i)=>{t.move(mv.san);const f=t.fen();const row=b.insertRow();row.onclick=()=>showPos(i);row.innerHTML=`<td>${i+1}</td><td><strong>${mv.san}</strong></td><td id="eval-${i}">...</td><td>${f.substring(0,15)}...</td>`;fullHistory.push({index:i,fen:f,move:mv.san,from:mv.from,to:mv.to,eval:null});evalQueue.push({index:i,fen:f,move:mv.san})});showPos(fullHistory.length-1);document.getElementById('nextBtn').disabled=true;log(`Loaded ${v.length} moves`);next()}catch(err){log(err.message,true)}}$(document).ready(()=>{board=Chessboard('myBoard',{position:'start',pieceTheme:'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'});evalChart=new Chart(document.getElementById('evalChart').getContext('2d'),{type:'line',data:{labels:[],datasets:[{label:'Advantage',data:[],borderColor:'#7fa650',backgroundColor:'rgba(127,166,80,0.1)',fill:true}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{min:-10,max:10}}}})});</script></body></html>

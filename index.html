<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Analysis</title><script src="https://code.jquery.com/jquery-3.5.1.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script><link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css"><script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><style>body{font:12px sans-serif;background:#161512;color:#eee;display:flex;flex-direction:column;align-items:center}.c{width:100%;max-width:1000px;background:#262421;padding:15px;border-radius:12px}#top{display:flex;gap:15px;flex-wrap:wrap;justify-content:center}#b-w{width:340px;position:relative}#myBoard{width:100%;border:3px solid #3c3934}#arrow-svg{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:10}.nav{display:flex;justify-content:space-between;margin:10px 0}#chart-w{flex:1;min-width:300px;background:#1a1917;height:250px;border-radius:8px}.p-info{display:flex;justify-content:space-around;margin-bottom:10px;font-size:14px;font-weight:700}.highlight{box-shadow:inset 0 0 3px 3px rgba(255,255,0,0.7)}.btn{background:#403d39;color:#fff;border:none;padding:8px 15px;border-radius:4px;cursor:pointer}table{width:100%;border-collapse:collapse;margin-top:15px;background:#1a1917}th,td{padding:6px;border-bottom:1px solid #333;text-align:left}</style></head><body><div class="c"><div class="p-info"><span id="pW">♔ White: -</span><span id="pB">♚ Black: -</span></div><div id="top"><div id="b-w"><div id="myBoard"></div><svg id="arrow-svg"></svg><div class="nav"><div><button class="btn" onclick="step(-1)">←</button><button class="btn" onclick="step(1)">→</button><button class="btn" onclick="board.flip();drawA()">Flip</button></div><div id="eval-d" style="font-size:1.2rem;font-weight:700">0.0</div></div></div><div id="chart-w"><canvas id="evalChart"></canvas></div></div><p id="st" style="text-align:center">Syncing...</p><table><thead><tr><th>#</th><th>Move</th><th>Eval</th><th>Best (Instead)</th></tr></thead><tbody id="m-b"></tbody></table></div><script>const UN='mrindyjones';let engine,board,chart,q=[],hist=[],ply=-1;function drawA(){const m=hist[ply];$('#arrow-svg').empty();if(!m||!m.b)return;const f=$(`.square-${m.b.slice(0,2)}`),t=$(`.square-${m.b.slice(2,4)}`);if(!f.length||!t.length)return;const r=document.getElementById('myBoard').getBoundingClientRect(),fR=f[0].getBoundingClientRect(),tR=t[0].getBoundingClientRect(),x1=fR.left-r.left+fR.width/2,y1=fR.top-r.top+fR.height/2,x2=tR.left-r.left+tR.width/2,y2=tR.top-r.top+tR.height/2;const s=document.createElementNS("http://www.w3.org/2000/svg","line");$(s).attr({x1,y1,x2,y2,stroke:"rgba(0,255,0,0.6)","stroke-width":6,"marker-end":"url(#ah)"});const h=document.createElementNS("http://www.w3.org/2000/svg","marker");$(h).attr({id:"ah",viewBox:"0 0 10 10",refX:5,refY:5,markerWidth:4,markerHeight:4,orient:"auto"});const p=document.createElementNS("http://www.w3.org/2000/svg","path");$(p).attr({d:"M 0 0 L 10 5 L 0 10 z",fill:"rgba(0,255,0,0.6)"});h.appendChild(p);const d=document.createElementNS("http://www.w3.org/2000/svg","defs");d.appendChild(h);$('#arrow-svg').append(d,s)}async function init(){const r=await fetch('https://raw.githubusercontent.com/niklasf/stockfish.js/master/stockfish.js'),s=await r.text(),b=new Blob([s],{type:'application/javascript'});engine=new Worker(URL.createObjectURL(b));engine.onmessage=e=>{const l=e.data.toString();if(l.includes('score cp')){const m=l.match(/score cp (-?\d+)/);if(m){let s=parseInt(m[1])/100;if(q[0].f.includes(' b '))s=-s;const val=(s>0?'+':'')+s.toFixed(1);hist[q[0].i].e=val;document.getElementById(`e-${q[0].i}`).innerText=val;chart.data.datasets[0].data[q[0].i]=s;chart.update()}}if(l.startsWith('bestmove')){const bm=l.split(' ')[1];hist[q[0].i].b=bm;document.getElementById(`b-${q[0].i}`).innerText=bm;if(q[0].i===ply)drawA();q.shift();next()}};engine.postMessage('uci');run()}function next(){if(q.length){engine.postMessage(`position fen ${q[0].pf}`);engine.postMessage(`go depth 12`)}else $('#st').text("Done")}function show(i){ply=i;const m=hist[i];board.position(m.f);$('.square-55d63').removeClass('highlight');if(m.fr&&m.to){$(`.square-${m.fr}`).addClass('highlight');$(`.square-${m.to}`).addClass('highlight')}drawA();$('#eval-d').text(m.e||"...")}function step(d){const n=ply+d;if(n>=0&&n<hist.length)show(n)}async function run(){const r=await fetch(`https://lichess.org/api/user/${UN}/current-game?t=${Date.now()}`);if(r.status===204)return;const p=await r.text(),c=new Chess();c.load_pgn(p);const h=c.header();$('#pW').text(`♔ White: ${h.White||'-'}`);$('#pB').text(`♚ Black: ${h.Black||'-'}`);board.orientation(h.Black?.toLowerCase()===UN?'black':'white');const b=$('#m-b').empty();q=[];hist=[];chart.data.labels=[];chart.data.datasets[0].data=[];const t=new Chess();c.history({verbose:true}).forEach((mv,i)=>{const pf=t.fen();t.move(mv.san);const f=t.fen();const row=$(`<tr onclick="show(${i})"><td>${i+1}</td><td>${mv.san}</td><td id="e-${i}">...</td><td id="b-${i}">...</td></tr>`);b.append(row);hist.push({i,f,pf,m:mv.san,fr:mv.from,to:mv.to,e:null,b:null});q.push({i,f,pf});chart.data.labels.push(mv.san);chart.data.datasets[0].data.push(null)});chart.update();show(hist.length-1);q.reverse();next()}$(document).ready(()=>{board=Chessboard('myBoard',{position:'start',pieceTheme:'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'});chart=new Chart(document.getElementById('evalChart').getContext('2d'),{type:'line',data:{labels:[],datasets:[{label:'Eval',data:[],borderColor:'#7fa650',fill:{target:'origin',above:'rgba(255,255,255,0.1)',below:'rgba(0,0,0,0.5)'},tension:0.3}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{min:-10,max:10}}}});init()});</script></body></html>
